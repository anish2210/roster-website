generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Employee {
  id            String         @id @default(cuid())
  firstName     String
  lastName      String
  email         String         @unique
  phone         String?
  position      String
  department    String?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  shifts        Shift[]
  employeeSites EmployeeSite[]

  @@map("employees")
}

model Shift {
  id          String      @id @default(cuid())
  employeeId  String
  siteId      String?
  date        DateTime
  startTime   DateTime
  endTime     DateTime
  shiftType   ShiftType   @default(REGULAR)
  status      ShiftStatus @default(SCHEDULED)
  notes       String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  employee    Employee    @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  site        Site?       @relation(fields: [siteId], references: [id], onDelete: SetNull)

  @@index([employeeId])
  @@index([siteId])
  @@index([date])
  @@map("shifts")
}

model Site {
  id                    String       @id @default(cuid())

  // Basic Information
  siteLocationName      String
  shortName             String
  jobRefNo              String?
  status                SiteStatus   @default(ACTIVE)
  client                String
  flatBillingRate       Decimal?     @db.Decimal(10, 2)
  alertRecipient        String?
  exportId              String?
  region                String?

  // Scheduling Settings
  remindEmployees       String?
  defaultStartTime      String?
  defaultEndTime        String?
  defaultShiftDuration  Int?

  // Address Information
  address               String?
  state                 String?
  townSuburb            String?
  postalCode            String?
  timezone              String       @default("(UTC+10:00) Canberra, Melbourne, Sydney")

  // GeoLocation
  latitude              Decimal?     @db.Decimal(10, 8)
  longitude             Decimal?     @db.Decimal(11, 8)
  geoFenceRadius        Decimal?     @db.Decimal(4, 2)

  // Contact Information
  contactPerson         String?
  contactPosition       String?
  contactPhone          String?
  contactMobile         String?
  contactEmail          String?
  contactNotes          String?      @db.Text

  // Metadata
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  // Relations
  accessCodes           AccessCode[]
  shifts                Shift[]
  employeeSites         EmployeeSite[]

  @@index([status])
  @@index([shortName])
  @@map("sites")
}

model AccessCode {
  id                String   @id @default(cuid())
  siteId            String

  codeName          String
  accessCode        String
  notes             String?  @db.Text
  visibleOnMobile   Boolean  @default(false)
  whenRostered      Boolean  @default(false)
  afterClockingIn   Boolean  @default(false)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  site              Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([siteId])
  @@map("access_codes")
}

model EmployeeSite {
  id          String   @id @default(cuid())
  employeeId  String
  siteId      String
  assignedAt  DateTime @default(now())
  isActive    Boolean  @default(true)

  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  site        Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([employeeId, siteId])
  @@index([employeeId])
  @@index([siteId])
  @@map("employee_sites")
}

enum UserRole {
  ADMIN
  MANAGER
  USER
}

enum ShiftType {
  REGULAR
  OVERTIME
  ON_CALL
  NIGHT
}

enum ShiftStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum SiteStatus {
  ACTIVE
  INACTIVE
}
